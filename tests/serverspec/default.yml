---
- hosts: localhost
  roles:
    - role: trombik.apt_repo
      when: ansible_os_family == 'Debian'
    - role: trombik.redhat_repo
      when: ansible_os_family == 'RedHat'
    - ansible-role-kibana
  vars:
    apt_repo_keys_to_add:
      - https://artifacts.elastic.co/GPG-KEY-elasticsearch
      - https://d3g5vo6xdbdb9a.cloudfront.net/GPG-KEY-opendistroforelasticsearch
    apt_repo_to_add:
      - ppa:openjdk-r/ppa
      - deb [arch=amd64] https://d3g5vo6xdbdb9a.cloudfront.net/apt stable main
      - deb https://artifacts.elastic.co/packages/oss-7.x/apt stable main
    apt_repo_enable_apt_transport_https: yes
    kibana_listen_host: localhost
    kibana_listen_port: 5601
    kibana_config:
      server.port: "{{ kibana_listen_port }}"
      server.host: 0.0.0.0
      kibana.index: .kibana
      logging.dest: "{{ kibana_log_dir }}/kibana.log"
      elasticsearch.hosts: ["http://localhost:9200"]
    os_kibana_flags:
      FreeBSD: |
        kibana_user="{{ kibana_user }}"
        kibana_group="{{ kibana_group }}"
        kibana_log="{{ kibana_log_dir }}/kibana.log"
        kibana_config="{{ kibana_config_file }}"
      Debian: |
        user="kibana"
        group="kibana"
        chroot="/"
        chdir="/"
        nice=""
        KILL_ON_STOP_TIMEOUT=1
      RedHat: ""
    kibana_flags: "{{ os_kibana_flags[ansible_os_family] }}"
